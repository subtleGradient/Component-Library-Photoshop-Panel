<!doctype html>
<meta charset=utf-8>
<title>ElementAttrObj example</title>

<script src="../vendor/es5-shim.min.js"></script>
<script src="../vendor/es5-sham.min.js"></script>

<script>require.cache = {};function require(id){ return require.cache[id.replace('./','').replace('.js','')] }</script>
<script>var module = {};var exports = module.exports = {};</script><script src="../lib/Obj.js"></script><script>require.cache['Obj'] = module.exports;</script>
<script>var module = {};var exports = module.exports = {};</script><script src="../lib/ElementAttrObj.js"></script><script>require.cache['ElementAttrObj'] = module.exports;</script>

<body>

<script>

try{

window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;

function Object_mergeShallow(to, from){
  Object.keys(from).forEach(function(key){
    to[key] = from[key]
  })
}
function Object_clonePropertyDescriptors(to, from){
  Object.getOwnPropertyNames(from).forEach(function(key){
    Object.defineProperty(to, key, Object.getOwnPropertyDescriptor(from, key))
  })
}

function setForEach(key, value){
  // console.log('Lots', 'set', key, value)
  if (key == 'template') this._template = value;
  if (key == 'data'){
    value.forEach(function(value, index){
      var config = this[index + 'Config'];
      if (!config) this[index + 'Config'] = config = {__proto__:this._template};
      Object_mergeShallow(config, value)
      this.__parent__.set(this.__key__ + index, config);
    },this)
  }
}

// ElementAttrObj.debug=true

var inputConfig = {
  nodeName:'input',
  onchange: function(event){
    this.value = this.node.value
    state.isDirty = true
  }
}

var rangeConfig = {
  __proto__:inputConfig,
  type:'range',
  min:0,max:1,step:0.01,
}

var config = {
  set:ElementAttrObj.prototype.set,
  // __proto__:ElementAttrObj.prototype,
  nodeName: 'div',
  parent: 'body',
  innerText: 'lulz',
  children: {
    Fred:{nodeName: 'div', innerText:'Fred'},
    Ginger:{nodeName: 'div', get innerText(){ return state.children && state.children.Lots0 && state.children.Lots0.awesomeness }},
    ExecutionCounter:{__proto__:inputConfig, get value(){return ++state.renderCount }},
    Range0:{__proto__:rangeConfig, max:5, defaultValue:1},
    Range0Value:{__proto__:inputConfig, get value(){ return state.children.Range0.value }},
    Lots:{
      set: setForEach,
      template: {__proto__:rangeConfig, get max(){return +state.children.Range0.value}, get value(){ return this.awesomeness || 'Not awesome' }},
      data: [
        {get awesomeness(){return Math.random()}},
        {awesomeness:Math.random()},
      ],
    },
  }
}

var state = {
  renderCount:0
}

// ElementAttrObj.prototype.debug=true
// ElementAttrObj.debug=true
// Obj.debug=true

state.isDirty = true;

function render(){
  if (state.isDirty){
    Obj(config, state);
    state.isDirty = false;
  }
  window.requestAnimationFrame(render);
}

render()

} catch(e){
  document.write(e)
}

</script>
