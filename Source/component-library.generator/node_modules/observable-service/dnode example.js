var dnode = require('dnode')

var client = dnode()

client.on('remote', function(fakeServer){
  
  fakeServer.set('foo', "foo", function(e){
    fakeServer.get('foo', function(e,v){
      console.log(v)
    })
  })
  
  fakeServer.observeMembers('', function onChange(added, removed, changed, getOldValue, observerId){
    console.log('', 'onChange', 'added', added, 'removed', removed, 'changed', changed, 'getOldValue', getOldValue, 'observerId', observerId)
  })
  // fakeServer.observeMembers('foo.bar', function onChange(added, removed, changed, getOldValue, observerId){
  //   console.log('foo.bar', 'onChange', 'added', added, 'removed', removed, 'changed', changed, 'getOldValue', getOldValue, 'observerId', observerId)
  // })
  // fakeServer.observe('setDirectlyOnTheServer', function onChange(newValue, oldValue){
  //   console.log(arguments)
  // })
  
})

var serverModel = {}
var server = dnode(function(){
  
  var model = require('./').create(serverModel)
  var interval = setInterval(function(){
    model.deliver()
  }, 100)
  // clearInterval(interval)
  
  return model
})

setInterval(function(){
  serverModel.foo = {bar:{baz:Math.random()}}
}, 500)
// setInterval(function(){
//   serverModel.foo.bar.baz = Math.random()
// }, 1000)

server.pipe(client).pipe(server)
// client.pipe(server).pipe(client)

client.pipe(process.stdout)
server.pipe(process.stdout)
